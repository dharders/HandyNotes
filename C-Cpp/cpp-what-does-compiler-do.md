#c-cpp #compile 
## 2023.03.04

Recently, I'm working with *Inside the c++ object model*, which talks a lot about what does compiler do for us.

As this book is written in 1996, when the first cpp compiler has just been created, I wonder if there are some difference in the current compiler.

Reading the codes generated by complier is the best way to check the correctness of the book.

## What does the complier do when construct a base class object with a derived class object? (p34)

```cpp
// class A : public B
B b;
A a = b;
```

```cpp
A a = A(static_cast<const A&>(b));
```

## When does the compiler provide you a non-trivial default constructor? How to check? (p40)

- If there is no explicit constructor, a default constructor will be implicitly declared. 

  It is a trival constructor mostly, wheras the compiler will only generate non-trival constructors under four circumstances. 

  With compile option `-fdump-tree-original`, you can see the code written by compiler.

  Only those four classes will get a non-trivial default constructor.

  ```cpp
  class classqwq {};
  class classxac : public virtual classqwq  {
   public:
    int a;    
  };
  ```

  `g++ -fdump-tree-original x.cpp`

  Following are the codes generated by compiler, you can also try in other situation.

  ```cpp
  ;; Function classxac::classxac() (null)
  ;; enabled by -tree-original


  {
    if (__in_chrg != 0)
      {
        
      }
    <<cleanup_point <<< Unknown tree: expr_stmt
      (void) (((struct classxac *) this)->_vptr.classxac = __in_chrg == 0 ? (int (*) () *) *NON_LVALUE_EXPR <__vtt_parm> : &_ZTV8classxac + 24) >>>>>;
  }
  ```

## When does the compiler do `NRV`? How to check? (p66)

Use `-fdump-tree-nrv` with `-O1` optimization to check the `NRV`.

```cpp
class classxac : public virtual classqwq {
 public:
  int a;
};

void foo(classxac a) { a.a = 1; }

int main() {
  classxac a;
  foo(a);
  return 0;
}
```

In this case, `classxac` must have a non-trival copy constructor, or it will implement bitwise copy.

```cpp

;; Function foo (_Z3foo8classxac, funcdef_no=2147, decl_uid=49314, cgraph_uid=551, symbol_order=585)

void foo (struct classxac & a)
{
  <bb 2> [local count: 1073741824]:
  a_2(D)->a = 1;
  return;

}
```


