#cg 
## 2023.01.31

##  shader graph 中的颜色

shader graph中所有展现出来的图片都是一个三通道的颜色，颜色表示不了比0小和比1大的，所有比0小的数作为0展示，所有比1大的数作为1来展示。若preview的输入不足3个，则其余通道补1。若preview的输入大于3个，则只取前3个通道。

要注意，此时只是不会表现出来，数值依然是比0小的数和比1大的数。

## 关键的结点

- uv

  uv0的中前两通道是物体的uv，由其颜色可以看出左下角为(0,0)黑色，随着往右，u坐标增大至1，随着往上v坐标增大至1，右上角为(1,1)白色

- pow

  对于0-1之间的数越pow越小，即越接近0

- clamp

  截断，所有小于min的截断到min，所有大于max的截断到max

- lerp

  由第三个输入T控制给出输入AB中的一个渐变过程，0输出A，1输出B，中间则输出一个融合（渐变）

- one minus

  用于反转黑白区域

- smooth step

  输出为0-1，第一个输入为变化出现的坐标，第二个输入为变化结束的坐标，第三个输入为取样坐标

  函数在第一个坐标前为0，第二个坐标后为1，中间是一个从0-1之间的平滑过渡，可以表达**经过**

  第一个输入与第二个输入越远，过渡越平滑（当第一个输入等于第二个输入时，在图像上表现为分段函数）

- noise, vorinoi

  经常被用来做随机噪声的结点

## 效果的基础

- Alpha通道控制你能看到什么，透明度的概念也可以理解为颜色的强弱

  1表示能看到，0表示看不到，也就是最终输出到A通道上的图片的白色部分是可以看见的，黑色部分是看不见的

- MainTex 主纹理

  - 单通道图片（将Alpha信息放在单通道中，如R通道），无其他颜色信息

    颜色由外部给出，可在shader graph中用vertex color获取外部给出的颜色

  - 启用HDR颜色

    有时颜色是从顶点或贴图获取，此时没有办法直接指定HDR颜色

    将颜色乘以一个数字即可（vertex_color.rgb * hdr_modifier）

    HDR颜色可以让颜色更具表现力，亮的更亮，暗的更暗，亮在颜色中的表现就是变白

    ![](./images/HDR-color.png)

    左图为modifier为1，即未开启HDR，右图为相同颜色下hdr_modifier为3，可以看到中心位置变白

- Dissolve 溶解

  - 溶解的基础就是让你看不到什么，也就是在透明度上做文章，任何数乘0都变为0，即不可见，

  - 固定位置溶解，也就是你可以用一张新的贴图指出你不想看见的地方，和原A通道输出相乘，以做到控制溶解位置的效果

  - 很多结点都可以控制溶解的强度，比如pow，subtract，也可以结合来使用，用来对溶解贴图做更细致的效果呈现

    ![pow结点控制强度](../.images/dissolvestrength.png)

  - 溶解动画

    - 溶解进度

      进度也就是意味着由0（完全不溶解，即DissovleTex完全不影响MainTex）到1（完全溶解，即DissolveTex完全multiple了MainTex）的过程。

      lerp结点在这里就可以起到效果，输入T的0-1范围正好可以控制溶解进度

      ![alt](../.images/dissolve-progress.gif)

    - 溶解进度2

      上面的方法仅能让DissovleTex缓慢出现，但溶解效果有时不只是需要溶解一半，溶解是为了让物体消失，lerp从0到1的溶解效果并不能实现让物体按我们的纹理溶解直到消失，此时就需要smoothstep结点来实现一个平滑的经过

      目标是从完全没有溶解，经过我们规定的溶解纹理进行平滑溶解直到完全消失

      ![alt](../.images/dissolve-progress-smoothstep-solid-upper.gif)

      原理：当slider不断变大时，首先slider作为一个阈值存在，不大于slider的像素都为0，控制整体的进度，表现在图像上就是亮度高的点会逐渐出现。其次slider继续变大的过程可以平滑使该像素变为完全可见（该像素完全变白）。
      
      也就是说和lerp相比其最小值为0最大值为1，而lerp是停止于固定的位置。可以理解为lerp求两个输入之间的平滑过渡，第三个输入为0-1之间，也就是将0-1映射到两个规定的输入之间。smoothstep是将两个值之间映射到0-1。

      观察gif会发现这样做会导致当slider到1时依然有黑色位置且边缘锯齿严重，这是因为原texture上该点值就为1，因此smoothstep所做的就是将[1,1]映射到[0,1]，导致了该问题的出现，对此解决方法有很多，比如将原tex减0.1，这样就可以从[0.9,1]映射到[0,1]。

      此时又会有一个新的问题，对于原本亮度非常高的点，也就是图中最终还为黑的边缘部分，他们从0->1的过程十分迅速。可以想象对于某一个高亮度点可能当slider为0.99时还是黑色，在slider变为1时突然变白，即对于亮度低的点如0.3，是从[0.3,1]映射到[0,1]，而对于亮度高的点如0.99，就是从[0.99,1]映射到[0,1]。这就导致对于有的点变化并不平滑，这可能不是我们想要的效果。

      解决这个问题的方法便是控制所有映射区间的长度相等，在上面我们将Edge2设为了一个固定值，所有的像素都是从[pixel.alpha,1]进行映射。要控制长度相等只需要让他们都加上1即可。即所有像素都是从[pixel.alpha,pixel.alpha+1]映射到[0,1]。此时每个像素都有了相同的平滑度。

      此时又有了新的需求，就是需要生硬的过渡，需要突变的效果，那我们可以让上面加的1变成一个可控的数值DissolveSmooth，调整该数值即可控制过渡的平滑与生硬。

      ![alt](../.images/dissolve-progress-smoothstep.gif)

      要注意smoothstep的第三个输入，最小值应该为两张Edge的最小值相等，最大值应该为两张Edge的最大值相等，这正好表达了一个像素平滑出现并变亮的过程。

    - 溶解贴图

      **溶解会从最终输出贴图亮度低的方向像高的方向发生。即由黑到白发生溶解。**

- Distortion 失真

  要理解失真首先得了解uv，也即纹理是怎么贴到物体上的，将模型的mesh展开成uv，将Texture贴上去，就获得了带有贴图的mesh。

  想要获得tex中的数据，需要使用sample2d结点对tex进行取样，而sample2d中有一个结点就是uv，该uv即物体uv，如果不对物体uv进行变换，则tex会按照最原本的样子附着到uv上。而随着uv的变化，tex的附着方式也会发生变化。

  首先要知道uv本身是一个四通道的数据，而只有前两个分量用得上，为了让图显示的更加直观，我只引出前两个通道。如果直接对uv4通道进行处理，zw分量也会受到影响，而我们只输出xy通道，这样看的不够清楚。

  ![alt](../.images/uv-xy.png)

  如简单的上下左右颠倒变换（如果只想颠倒一边，那就单独处理一个分量）：

  ![alt](../.images/uv-xy-flip.png)

  还有基础的位移和缩放：（gif图片采样率不够导致颜色失真）

  ![alt](../.images/uv-tiling-and-offset.gif)

  记住uv颜色和tex对于的位置（黑色左下，黄色左上等等），这样看到uv的颜色就知道最终的sample结果是什么样的了。

  因此想要做出失真的效果，就需要对uv进行变化，在原uv上叠加一层噪声即可完成失真的效果。

  - 思考应该如何变化uv？

    add？会导致uv整体变亮，即靠向1，根据对uv的理解会导致只能获得图像的右上方

    multiple？会导致uv整体变暗，只能得到图像的左下方

    *可以对noise做pow或multiple来控制效果*

    以上都是可选的效果，但都会导致图像的位置发生一定的偏移。我们只想干扰特定的像素点而不想让整体图像发生偏移，lerp是很好的选择。

    此时lerp的第三个输入控制扰动的强度，获得一个介于正常uv和完全扰动之间的图作为uv。该操作不会导致图像的整体偏移，正好能达成我们想要的扰动的效果。

    ![alt](../.images/uv-distortion.gif)

    当扰动强度过大时该扰动就没有什么意义了，因为此时的uv基本就是这个噪声决定的。
  
  - 扰动动画

    扰动的动画很简单，只需要让噪声动起来就可以了。通过一个tilting结点即可做到。

  - 部分扰动

    如果只想让贴图的某一部分扰动要怎么做？同样是采用lerp结点，此时使用uv结点的xy分量并进行一定的运算可以做到控制某些部分在扰动中保持不变。

    ![alt](../.images/uv-partial-distortion.gif)

## 效果的分解

- 火

  本体

  1. 序列图发射叠加，大小，旋转

  2. 单图uv扰动，

  火星

  1. 点发射，速度变慢，大小变小，颜色透明出现透明，noise做随机游走

  烟雾




-